Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
animation.js:3180:17
No token, using mock data. loadService.js:135:21
Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
animation.js:3180:17
No token, using mock data. loadService.js:135:21
Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
animation.js:3180:17
No token, using mock data. loadService.js:135:21
Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
animation.js:3180:17
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1536746803623-cef87080bfc9
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1566908829818-b5e5642c53b8
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1590650516494-0c8e4a4dd61b
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1581093458791-8a6b22b5d6e3
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1541746972996-4e0b0f43e9a4
No token, using mock data. loadService.js:135:21
Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
animation.js:3180:17
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1581093458791-8a6b22b5d6e3
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1536746803623-cef87080bfc9
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1590650516494-0c8e4a4dd61b
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1566908829818-b5e5642c53b8
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1541746972996-4e0b0f43e9a4
No token, using mock data. loadService.js:135:21
Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
animation.js:3180:17
No token, using mock data. loadService.js:135:21
Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
animation.js:3180:17
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1566908829818-b5e5642c53b8
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1536746803623-cef87080bfc9
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1581093458791-8a6b22b5d6e3
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1541746972996-4e0b0f43e9a4
A resource is blocked by OpaqueResponseBlocking, please check browser console for details. photo-1590650516494-0c8e4a4dd61b
No token, using mock data. loadService.js:135:21
Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
animation.js:3180:17
No token, using mock data. loadService.js:135:21
Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
animation.js:3180:17
‚úÖ Serveur disponible pour Network Monitoring utils.js:390:13
‚úÖ Serveur disponible pour Network Monitoring utils.js:390:13
‚úÖ Serveur disponible pour Network Monitoring utils.js:390:13
‚úÖ Serveur disponible pour Network Monitoring utils.js:390:13
No token, using mock data. loadService.js:135:21
Erreur lors du chargement des services: TypeError: can't access property "classList", paginationContainer is null
    renderServicePagination http://localhost:3000/js/injection/loadService.js:333
    renderServicesSidebar http://localhost:3000/js/injection/loadService.js:317
    updateServices http://localhost:3000/js/animations/animation.js:3161
    initSearch http://localhost:3000/js/animations/animation.js:2947
animation.js:3180:17



loadservice :

/**
 * @file loadServices.js
 * @description Charge et g√®re les donn√©es des services avec mise en cache et fallback sur donn√©es mock
 * @version Updated for futuristic design and advanced interactions
 */

import { getStoredToken, showNotification } from '../modules/utils.js';
import api from '../api.js';

// Configuration du cache
const SERVICES_CACHE_KEY = 'servicesDataCache';
const CACHE_TTL = 5 * 60 * 1000; // 5 minutes

// Ic√¥nes des services (√©tendu)
const serviceIcons = {
    bureaux: 'üè¢',
    residentiel: 'üè†',
    commercial: 'üõçÔ∏è',
    industriel: 'üè≠',
    medical: 'üè•',
    hotelier: 'üè®',
    education: 'üéì',
    restaurant: 'üçΩÔ∏è',
    sport: 'üí™',
    evenementiel: 'üé™',
    piscine: 'üèä',
    vitres: 'üîç',
    facade: 'üèõÔ∏è',
    parking: 'üÖøÔ∏è',
    jardin: 'üåø'
};

// Ic√¥nes d'√©quipement (√©tendu)
const equipmentIcons = {
    vacuum: 'üßπ',
    mop: 'ü™£',
    spray: 'üß¥',
    broom: 'üßπ',
    bucket: 'ü™£',
    cloth: 'üßΩ',
    polisher: '‚ú®',
    brush: 'üñåÔ∏è',
    duster: 'ü™∂',
    scraper: 'üî™',
    extractor: 'üíß',
    pressure_washer: 'üí¶',
    steam_cleaner: '‚ô®Ô∏è',
    floor_machine: '‚öôÔ∏è'
};

let MOCK_SERVICES = [];
let allFilteredServices = [];
let currentServiceIndex = 0;
let paginationVisiblePages = 5; // Number of visible page buttons
let currentPageOffset = 0; // For ellipsis pagination

/**
 * Affiche/masque l'animation de chargement
 */
function toggleServicesLoading(show) {
    const loadingEl = document.getElementById('services-loading');
    if (!loadingEl) return;

    loadingEl.classList.toggle('hidden', !show);
}

/**
 * Charge les services mock depuis JSON
 */
async function loadMockServices() {
    try {
        const response = await fetch('/assets/json/mock/mock-services.json');
        if (response.ok) {
            MOCK_SERVICES = await response.json();

            // Enrichir les donn√©es mock avec des informations r√©alistes
            MOCK_SERVICES = MOCK_SERVICES.services.map(service => ({
                ...service,
                icon: serviceIcons[service.category] || serviceIcons.bureaux,
                equipment: (service.equipment || ['vacuum', 'mop', 'spray']).map(eq => ({
                    icon: equipmentIcons[eq] || equipmentIcons.vacuum,
                    name: eq
                })),
                certification: service.certification || getRandomCertification(),
                garantie: service.garantie || '30 jours',
                delai_intervention: service.delai_intervention || getRandomInterventionTime(),
                zone_intervention: service.zone_intervention || '√éle-de-France'
            }));
        } else {
            throw new Error('Failed to load mock services');
        }
    } catch (error) {
        console.error('Error loading mock services:', error);
        showNotification('Erreur lors du chargement des donn√©es mock.', 'error');
        MOCK_SERVICES = [];
    }
}

/**
 * Retourne une certification al√©atoire
 */
function getRandomCertification() {
    const certifications = [
        'NF X50-900',
        'ISO 9001',
        'Qualibat',
        'Ecocert',
        'Label Origine France Garantie'
    ];
    return certifications[Math.floor(Math.random() * certifications.length)];
}

/**
 * Retourne un d√©lai d'intervention al√©atoire
 */
function getRandomInterventionTime() {
    const delais = ['24h', '48h', '72h', '1 semaine'];
    return delais[Math.floor(Math.random() * delais.length)];
}

// Charger les services mock au d√©marrage
loadMockServices();

/**
 * Charge tous les services avec filtres
 */
export async function loadServices(filters = {}) {
    toggleServicesLoading(true);
    
    try {
        const token = getStoredToken();
        let services;

        if (!token) {
            console.log('No token, using mock data.');
            services = MOCK_SERVICES;
        } else {
            let cachedData = getCachedServices();
            if (cachedData) {
                console.log('Using cached data.');
                services = cachedData;
            } else {
                console.log('Fetching from API...');
                const apiData = await api.service.getAllServices(1, 100, filters);
                
                if (apiData?.services && apiData.services.length > 0) {
                    services = apiData.services.map(service => ({
                        ...service,
                        icon: serviceIcons[service.category] || serviceIcons.bureaux,
                        equipment: (service.equipment || ['vacuum', 'mop', 'spray']).map(eq => ({
                            icon: equipmentIcons[eq] || equipmentIcons.vacuum,
                            name: eq
                        }))
                    }));
                    cacheServices(services);
                } else {
                    console.log('API empty, using mock.');
                    services = MOCK_SERVICES;
                }
            }
        }

        // Appliquer les filtres
        allFilteredServices = applyFilters(services, filters);
        return allFilteredServices;
        
    } catch (error) {
        console.error('Error loading services:', error);
        showNotification('Erreur lors du chargement des services.', 'error');
        allFilteredServices = applyFilters(MOCK_SERVICES, filters);
        return allFilteredServices;
    } finally {
        toggleServicesLoading(false);
    }
}

/**
 * Applique les filtres avanc√©s
 */
function applyFilters(services, filters) {
    const { category, frequency, difficulty, reviewsMin, search } = filters;
    
    return services.filter(service => {
        const categoryMatch = !category || category === 'all' || service.category === category;
        const frequencyMatch = !frequency || frequency === 'all' || service.frequency === frequency;
        const difficultyMatch = !difficulty || difficulty === 'all' || service.difficulty === difficulty;
        const reviewsMatch = !reviewsMin || service.reviews >= reviewsMin;
        
        // Recherche textuelle
        const searchMatch = !search || 
            service.name.toLowerCase().includes(search.toLowerCase()) ||
            service.description.toLowerCase().includes(search.toLowerCase()) ||
            service.features.some(feature => feature.toLowerCase().includes(search.toLowerCase()));
        
        return categoryMatch && frequencyMatch && difficultyMatch && reviewsMatch && searchMatch;
    });
}

/**
 * Met en cache les services avec TTL
 */
function cacheServices(services) {
    try {
        const cacheData = { data: services, timestamp: Date.now() };
        localStorage.setItem(SERVICES_CACHE_KEY, JSON.stringify(cacheData));
    } catch (error) {
        console.error('Cache error:', error);
    }
}

/**
 * R√©cup√®re les services en cache s'ils sont valides
 */
function getCachedServices() {
    try {
        const cached = localStorage.getItem(SERVICES_CACHE_KEY);
        if (!cached) return null;
        
        const { data, timestamp } = JSON.parse(cached);
        if (Date.now() - timestamp < CACHE_TTL) return data;
        
        localStorage.removeItem(SERVICES_CACHE_KEY);
        return null;
    } catch (error) {
        console.error('Retrieve cache error:', error);
        return null;
    }
}

/**
 * Rend la barre lat√©rale des services et g√®re la visibilit√© (cach√© sur mobile)
 * Met √† jour le d√©tail du service pour le premier √©l√©ment s√©lectionn√©
 */
export function renderServicesSidebar(services) {
    const sidebarContainer = document.getElementById('services-sidebar-container');
    const sidebar = document.getElementById('services-sidebar');
    if (!sidebar || !sidebarContainer) return;

    // Cach√© sur mobile par d√©faut (xl:block dans CSS)
    if (services.length < 2) {
        sidebarContainer.classList.add('hidden');
    } else {
        sidebarContainer.classList.remove('hidden');
    }

    sidebar.innerHTML = services.map((service, index) => {
        // Trouver la premi√®re image 'after'
        const afterImage = service.images?.find(img => img.type === 'after') || { url: '/assets/images/placeholder.jpg' }; // Fallback si pas d'image after
        
        // Cat√©gorie comme label
        const categoryLabel = service.category ? `<span class="text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-1 rounded-full">${service.category}</span>` : '';

        return `
            <button class="service-sidebar-item w-full text-left p-6 rounded-2xl border border-white/20 dark:border-gray-700/50 backdrop-blur-sm hover:bg-white/70 dark:hover:bg-gray-700/70 transition-all duration-300 group service-card ${
                index === currentServiceIndex ? 'border-white/50 bg-white/90 dark:bg-gray-700/90 shadow-xl ring-1 ring-white/30' : 'bg-white/50 dark:bg-gray-800/50'
            }" data-service-index="${index}">
                <div class="flex flex-col gap-4 h-full">
                    <!-- Image principale -->
                    <img src="${afterImage.url}" alt="${service.name}" class="w-full h-32 object-cover rounded-xl group-hover:scale-105 transition-transform duration-300">
                    
                    <!-- Contenu principal -->
                    <div class="flex-1 min-h-0">
                        <h4 class="font-semibold text-gray-900 dark:text-white text-lg truncate group-hover:text-ll-blue transition-colors">${service.name}</h4>
                        
                        <!-- Rating et reviews -->
                        <div class="flex items-center gap-2 mt-2">
                            <div class="flex text-yellow-400 text-sm">
                                ${renderStarRating(service.rating)}
                            </div>
                            <span class="text-xs text-gray-500 dark:text-gray-400">(${service.reviews})</span>
                        </div>
                    </div>
                    
                    <!-- Labels en bas : ic√¥ne et cat√©gorie -->
                    <div class="flex items-center justify-between pt-2 border-t border-gray-200/50 dark:border-gray-600/50">
                        <div class="flex items-center gap-3">
                            <span class="text-xl transform group-hover:scale-110 transition-transform">${service.icon}</span>
                            ${categoryLabel}
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-ll-blue opacity-0 group-hover:opacity-100 transition-opacity transform group-hover:translate-x-1">
                            <path d="M5 12h14"></path><path d="M12 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </div>
            </button>
        `;
    }).join('');

    // Gestion des clics sur les √©l√©ments de la barre lat√©rale - utilise navigateService
    sidebar.querySelectorAll('.service-sidebar-item').forEach((item, index) => {
        item.addEventListener('click', () => {
            const direction = index > currentServiceIndex ? 'next' : index < currentServiceIndex ? 'prev' : null;
            if (direction) {
                navigateService(direction, index - currentServiceIndex);
            } else {
                currentServiceIndex = index;
                renderServiceDetail(services[index], index, services.length);
            }
            
            // Mettre √† jour les classes actives
            sidebar.querySelectorAll('.service-sidebar-item').forEach((el, i) => {
                if (i === index) {
                    el.classList.add('border-white/50', 'bg-white/90', 'dark:bg-gray-700/90', 'shadow-xl', 'ring-1', 'ring-white/30');
                    el.classList.remove('border-white/20', 'dark:border-gray-700/50', 'bg-white/50', 'dark:bg-gray-800/50');
                } else {
                    el.classList.remove('border-white/50', 'bg-white/90', 'dark:bg-gray-700/90', 'shadow-xl', 'ring-1', 'ring-white/30');
                    el.classList.add('border-white/20', 'dark:border-gray-700/50', 'bg-white/50', 'dark:bg-gray-800/50');
                }
            });
        });
    });

    // Mettre √† jour le s√©lecteur mobile
    updateMobileServiceSelector(services);

    // Mettre √† jour la pagination
    renderServicePagination(services.length);

    // Si services.length > 0, afficher le premier service
    if (services.length > 0 && currentServiceIndex === 0) {
        renderServiceDetail(services[0], 0, services.length);
    }
}


/**
 * Rend la pagination des services avec ellipsis et bouton "more"
 */
function renderServicePagination(totalServices) {
    const paginationContainer = document.getElementById('service-pagination');
    const pagesContainer = document.getElementById('service-pages');
    if (!paginationContainer || !pagesContainer || totalServices < 2) {
        paginationContainer.classList.add('hidden');
        return;
    }

    const totalPages = totalServices;
    const currentPage = currentServiceIndex + 1;
    const maxVisible = paginationVisiblePages;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
    let endPage = Math.min(totalPages, startPage + maxVisible - 1);

    if (endPage - startPage + 1 < maxVisible) {
        startPage = Math.max(1, endPage - maxVisible + 1);
    }

    let pagesHTML = '';

    // First page
    if (startPage > 1) {
        pagesHTML += `<button class="service-page-btn px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white font-medium hover:bg-ll-blue hover:text-white transition-all duration-300 transform hover:scale-105" data-page="1">1</button>`;
        if (startPage > 2) {
            pagesHTML += `<span class="pagination-ellipsis mx-1 text-sm">...</span>`;
        }
    }

    // Visible pages
    for (let i = startPage; i <= endPage; i++) {
        pagesHTML += `
            <button class="service-page-btn px-4 py-2 rounded-full ${i === currentPage ? 'bg-ll-blue text-white shadow-lg neon-glow' : 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white'} font-medium hover:bg-ll-blue hover:text-white transition-all duration-300 transform hover:scale-105" data-page="${i}">
                ${i}
            </button>
        `;
    }

    // Ellipsis and more button if needed
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            pagesHTML += `<span class="pagination-ellipsis mx-1 text-sm">...</span>`;
        }
        pagesHTML += `<button class="service-page-btn px-4 py-2 rounded-full bg-ll-blue text-white font-medium hover:shadow-lg neon-glow transition-all duration-300 transform hover:scale-105 pagination-more" data-page="${totalPages}">‚Üí</button>`;
    }

    pagesContainer.innerHTML = pagesHTML;

    paginationContainer.classList.remove('hidden');

    // √âv√©nements pour les boutons de pagination - utilise navigateService
    document.getElementById('service-prev').onclick = () => navigateService('prev');
    document.getElementById('service-next').onclick = () => navigateService('next');

    pagesContainer.querySelectorAll('.service-page-btn').forEach(btn => {
        btn.onclick = (e) => {
            e.stopPropagation();
            const page = parseInt(btn.dataset.page);
            if (page !== currentPage) {
                const delta = page - currentPage;
                navigateService(delta > 0 ? 'next' : 'prev', Math.abs(delta));
            }
        };
    });

    // Mettre √† jour les √©tats des boutons prev/next
    document.getElementById('service-prev').disabled = currentPage === 1;
    document.getElementById('service-next').disabled = currentPage === totalPages;
}

/**
 * Met √† jour le s√©lecteur de services mobile
 */
function updateMobileServiceSelector(services) {
    const mobileSelector = document.getElementById('mobile-service-selector');
    if (!mobileSelector) return;

    // Sauvegarder l'option s√©lectionn√©e actuelle
    const currentValue = mobileSelector.value;

    mobileSelector.innerHTML = '<option value="">S√©lectionnez un service</option>' + 
        services.map((service, index) => `
            <option value="${index}" ${index === currentServiceIndex ? 'selected' : ''}>
                ${service.name} (${service.rating} ‚≠ê)
            </option>
        `).join('');

    // Restaurer la s√©lection si possible
    if (currentValue && services[currentValue]) {
        mobileSelector.value = currentValue;
    }

    // G√©rer le changement de s√©lection - utilise navigateService
    mobileSelector.addEventListener('change', (e) => {
        const selectedIndex = parseInt(e.target.value);
        if (!isNaN(selectedIndex) && services[selectedIndex]) {
            const delta = selectedIndex - currentServiceIndex;
            navigateService(delta > 0 ? 'next' : 'prev', Math.abs(delta));
        }
    });
}

/**
 * Rend le d√©tail d'un service
 */
export function renderServiceDetail(service, index = 0, total = 1) {
    const container = document.getElementById('service-detail-container');
    if (!container) return;

    // Carousel d'images - height corrig√©e et responsive
    const imagesWrapper = document.getElementById('service-images');
    if (imagesWrapper) {
        imagesWrapper.innerHTML = service.images.map((img, imgIndex) => `
            <div class="swiper-slide relative">
                <img src="${img.url}" alt="${img.description}" class="w-full h-64 md:h-80 lg:h-96 object-cover rounded-xl" loading="lazy">
                ${img.type === 'before' ? `
                    <span class="absolute top-4 left-4 bg-red-500/90 text-white px-3 py-1 rounded-full text-sm font-semibold backdrop-blur-sm">Avant</span>
                ` : img.type === 'after' ? `
                    <span class="absolute top-4 left-4 bg-green-500/90 text-white px-3 py-1 rounded-full text-sm font-semibold backdrop-blur-sm">Apr√®s</span>
                ` : ''}
            </div>
        `).join('');

        // R√©initialiser Swiper pour √©viter la disparition
        if (window.Swiper) {
            // Supprimer l'instance pr√©c√©dente si elle existe
            const swiperEl = document.querySelector('.service-image-swiper');
            if (swiperEl.swiper) {
                swiperEl.swiper.destroy(true, true);
            }
            
            setTimeout(() => {
                const newSwiper = new window.Swiper('.service-image-swiper', {
                    slidesPerView: 1,
                    spaceBetween: 0,
                    pagination: { 
                        el: '.swiper-pagination',
                        clickable: true,
                        renderBullet: function (index, className) {
                            return `<span class="${className} !w-3 !h-3 !bg-white/50 !opacity-50 hover:!opacity-100 !transition-all"></span>`;
                        }
                    },
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                    },
                    loop: service.images.length > 1,
                    lazy: true,
                    autoplay: service.images.length > 1 ? {
                        delay: 5000,
                        disableOnInteraction: false,
                    } : false,
                    effect: 'fade',
                    fadeEffect: {
                        crossFade: true
                    }
                });
                
                // Assurer que l'instance est stock√©e
                swiperEl.swiper = newSwiper;
            }, 150); // Augment√© l√©g√®rement pour stabilit√©
        }
    }

    // D√©tails du service
    document.getElementById('service-name').textContent = service.name;
    document.getElementById('service-description').textContent = service.description;
    
    // Note et avis
    const ratingEl = document.getElementById('service-rating');
    const ratingValueEl = document.getElementById('service-rating-value');
    const reviewsEl = document.getElementById('service-reviews');
    
    if (ratingEl) ratingEl.innerHTML = renderStarRating(service.rating);
    if (ratingValueEl) ratingValueEl.textContent = service.rating.toFixed(1);
    if (reviewsEl) reviewsEl.textContent = `${service.reviews} avis`;

    // Difficult√© avec badge color√©
    const difficultyEl = document.getElementById('service-difficulty');
    if (difficultyEl) {
        const difficultyColors = {
            easy: 'difficulty-easy',
            medium: 'difficulty-medium',
            hard: 'difficulty-hard'
        };
        const difficultyText = {
            easy: 'Facile',
            medium: 'Moyen',
            hard: 'Difficile'
        };
        difficultyEl.textContent = difficultyText[service.difficulty];
        difficultyEl.className = `difficulty-badge ${difficultyColors[service.difficulty]}`;
    }

    // Caract√©ristiques avec scroll
    const featuresList = document.getElementById('service-features');
    if (featuresList) {
        featuresList.innerHTML = service.features.map(feature => `
            <li class="flex items-center gap-3 p-3 bg-white/50 dark:bg-gray-600/30 rounded-lg hover:bg-white dark:hover:bg-gray-600 transition-colors group">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500 flex-shrink-0">
                    <path d="M20 6 9 17l-5-5"></path>
                </svg>
                <span class="text-gray-700 dark:text-gray-300 group-hover:text-gray-900 dark:group-hover:text-white">${feature}</span>
            </li>
        `).join('');
    }

    // √âquipement avec icons
    const equipmentEl = document.getElementById('service-equipment');
    if (equipmentEl) {
        equipmentEl.innerHTML = service.equipment.map(eq => `
            <div class="text-center group cursor-pointer transform hover:scale-110 transition-all duration-300">
                <div class="bg-white dark:bg-gray-700 rounded-xl p-4 shadow-lg hover:shadow-xl border-2 border-transparent hover:border-ll-blue">
                    <span class="text-3xl block mb-2">${eq.icon}</span>
                    <span class="text-xs text-gray-600 dark:text-gray-400 font-medium capitalize">${eq.name}</span>
                </div>
            </div>
        `).join('');
    }

    // Membres de l'√©quipe avec ratings
    const membersEl = document.getElementById('service-members');
    if (membersEl) {
        membersEl.innerHTML = service.members.map(member => `
            <div class="flex items-center gap-4 p-4 bg-white/50 dark:bg-gray-600/30 rounded-xl hover:bg-white dark:hover:bg-gray-600 transition-all duration-300 group">
                <img src="${member.photo}" alt="${member.name}" class="w-12 h-12 md:w-16 md:h-16 rounded-xl object-cover border-2 border-transparent group-hover:border-ll-blue transition-colors">
                <div class="flex-1">
                    <p class="font-semibold text-gray-900 dark:text-white group-hover:text-ll-blue transition-colors">${member.name}</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${member.role}</p>
                    <div class="flex gap-1 mt-2">
                        ${Array.from({ length: 5 }, (_, i) => `
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="${i < 4 ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                        `).join('')}
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Disponibilit√©
    const availabilityEl = document.getElementById('service-availability');
    const scheduleEl = document.getElementById('service-schedule');
    
    if (availabilityEl) {
        availabilityEl.textContent = service.availability.isAvailable ? 
            '‚úÖ Service disponible imm√©diatement' : 
            '‚ùå Service temporairement indisponible';
    }
    
    if (scheduleEl) {
        scheduleEl.innerHTML = service.availability.schedule.map(sch => `
            <li class="flex items-center justify-between p-3 bg-white/50 dark:bg-gray-600/30 rounded-lg hover:bg-white dark:hover:bg-gray-600 transition-colors">
                <span class="font-medium text-gray-700 dark:text-gray-300 capitalize">${sch.day}</span>
                <span class="dark:text-ll-white text-ll-black font-semibold">${sch.hours.join(' - ')}</span>
            </li>
        `).join('');
    }

    // Informations compl√©mentaires
    document.getElementById('service-certification').textContent = service.certification || 'Non sp√©cifi√©';
    document.getElementById('service-garantie').textContent = service.garantie || 'Non sp√©cifi√©';
    document.getElementById('service-delai').textContent = service.delai_intervention || 'Non sp√©cifi√©';

    // Boutons d'action
    const bookButton = document.getElementById('book-service');
    const demoButton = document.getElementById('demo-service');
    const moreInfoButton = document.getElementById('more-info-service');

    if (bookButton) {
        bookButton.onclick = () => {
            showNotification(`Service "${service.name}" r√©serv√© avec succ√®s !`, 'success');
            // Redirection vers la page de r√©servation
            window.location.href = `/reservation?service=${service.id}`;
        };
    }

    if (demoButton) {
        demoButton.onclick = () => {
            if (window.openVideoModal && service.videoDemo) {
                window.openVideoModal(service.videoDemo);
            } else {
                showNotification('D√©monstration vid√©o non disponible pour ce service.', 'info');
            }
        };
    }

    if (moreInfoButton) {
        moreInfoButton.href = `/services/${service.id}`;
    }

    highlightSearchTerms(service);

    // Mettre √† jour le s√©lecteur mobile
    updateMobileServiceSelector(allFilteredServices);

    AOS.refresh();
}

/**
 * Met en surbrillance les termes de recherche avec highlight futuriste
 */
function highlightSearchTerms(service) {
    const searchTerm = document.getElementById('service-search')?.value;
    if (!searchTerm) return;

    const elements = [
        document.getElementById('service-name'),
        document.getElementById('service-description')
    ];

    elements.forEach(element => {
        if (element) {
            const text = element.textContent;
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            const highlighted = text.replace(regex, '<mark class="bg-gradient-to-r from-yellow-200 to-yellow-400 dark:from-yellow-600 dark:to-yellow-800 px-1 rounded neon-glow">$1</mark>');
            element.innerHTML = highlighted;
        }
    });
}

/**
 * Rend la notation par √©toiles avec animation futuriste
 */
function renderStarRating(rating) {
    const fullStars = Math.floor(rating);
    const hasHalfStar = rating % 1 >= 0.5;
    const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);

    let stars = '';
    
    // √âtoiles pleines
    for (let i = 0; i < fullStars; i++) {
        stars += `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="url(#gold-gradient)" stroke="currentColor" stroke-width="1" class="star-filled transform hover:scale-110 transition-all neon-glow" data-rating="${i + 1}">
                <defs>
                    <linearGradient id="gold-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#fbbf24"/>
                        <stop offset="100%" stop-color="#f59e0b"/>
                    </linearGradient>
                </defs>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
        `;
    }
    
    if (hasHalfStar) {
        stars += `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="url(#half-gold)" stroke="currentColor" stroke-width="1" class="star-filled transform hover:scale-110 transition-all neon-glow">
                <defs>
                    <linearGradient id="half-gold" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="50%" stop-color="#fbbf24"/>
                        <stop offset="50%" stop-color="transparent"/>
                    </linearGradient>
                </defs>
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
        `;
    }
    
    // √âtoiles vides
    for (let i = 0; i < emptyStars; i++) {
        stars += `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" class="star-empty transform hover:scale-110 transition-all neon-glow" data-rating="${fullStars + (hasHalfStar ? 1 : 0) + i + 1}">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
        `;
    }

    return stars;
}

/**
 * Navigue vers le service pr√©c√©dent/suivant avec delta pour pagination avanc√©e
 */
export function navigateService(direction, delta = 1) {
    const total = allFilteredServices.length;
    if (total === 0) return;

    let newIndex = currentServiceIndex;
    if (direction === 'prev') {
        newIndex = Math.max(0, currentServiceIndex - delta);
    } else if (direction === 'next') {
        newIndex = Math.min(total - 1, currentServiceIndex + delta);
    }

    if (newIndex !== currentServiceIndex) {
        currentServiceIndex = newIndex;
        renderServiceDetail(allFilteredServices[currentServiceIndex], currentServiceIndex, total);
        renderServicesSidebar(allFilteredServices);
        AOS.refresh();
    }
}

export function ServiceIndex(){
    return currentServiceIndex;
}

export default {
    loadServices,
    renderServicesSidebar,
    renderServiceDetail,
    navigateService,
    toggleServicesLoading,
};



animations.js :


import loadServicesModule, { ServiceIndex } from '../injection/loadService.js';
const { loadServices, renderServicesSidebar, renderServiceDetail, navigateService, toggleServicesLoading } = loadServicesModule;





let reviewsModal = null;
let categoryModal = null;
let filterInactivityTimer = null;
const INACTIVITY_CLOSE_DELAY = 5000; 

/**
 * Initialise les modales vid√©o avec gestion plein √©cran et effets futuristes
 */
export function initVideoModal() {
    const videoModal = document.createElement('div');
    videoModal.id = 'video-modal';
    videoModal.className = 'fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4 transition-all duration-500 backdrop-blur-xl hidden modal-overlay';
    videoModal.innerHTML = `
        <div class="modal-content bg-gradient-to-b from-black/80 to-black/100 text-white max-w-6xl w-full relative overflow-hidden neon-glow">
            <button class="absolute -top-4 right-0 text-white text-2xl z-10 close-video-modal hover:text-blue-400 transition-all p-3 rounded-full hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500 neon-glow" aria-label="Fermer la modale vid√©o">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 6L6 18"></path><path d="M6 6l12 12"></path>
                </svg>
            </button>
            <div class="aspect-video bg-black rounded-xl overflow-hidden relative">
                <video id="modal-video" class="w-full h-full" controls preload="metadata" poster="/assets/images/video-poster.jpg">
                    <source src="" type="video/mp4">
                    Votre navigateur ne supporte pas la balise vid√©o.
                </video>
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent pointer-events-none"></div>
            </div>
            <div class="absolute bottom-6 right-6 flex gap-3">
                <button class="fullscreen-video bg-black/60 text-white p-3 rounded-xl hover:bg-black/80 transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-blue-500 neon-glow" aria-label="Passer en plein √©cran">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3"></path><path d="M21 8V5a2 2 0 0 0-2-2h-3"></path><path d="M3 16v3a2 2 0 0 0 2 2h3"></path><path d="M16 21h3a2 2 0 0 0 2-2v-3"></path>
                    </svg>
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(videoModal);

    const modalVideo = document.getElementById('modal-video');
    const closeButton = videoModal.querySelector('.close-video-modal');
    const fullscreenButton = videoModal.querySelector('.fullscreen-video');

    const closeModal = () => {
        videoModal.classList.remove('open');
        setTimeout(() => {
            videoModal.classList.add('hidden');
            modalVideo.pause();
            modalVideo.currentTime = 0;
            document.body.style.overflow = 'auto';
        }, 300);
    };

    closeButton.addEventListener('click', closeModal);

    videoModal.addEventListener('click', e => {
        if (e.target === videoModal) {
            closeModal();
        }
    });

    fullscreenButton.addEventListener('click', () => {
        if (modalVideo.requestFullscreen) {
            modalVideo.requestFullscreen();
        } else if (modalVideo.webkitRequestFullscreen) {
            modalVideo.webkitRequestFullscreen();
        } else if (modalVideo.msRequestFullscreen) {
            modalVideo.msRequestFullscreen();
        }
    });

    // Keyboard navigation
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && !videoModal.classList.contains('hidden')) {
            closeModal();
        }
    });

    // Video ended event
    modalVideo.addEventListener('ended', () => {
        setTimeout(closeModal, 2000);
    });

    // Exposer la fonction pour ouvrir la modale vid√©o
    window.openVideoModal = (videoSrc) => {
        videoModal.classList.remove('hidden');
        setTimeout(() => videoModal.classList.add('open'), 10);
        modalVideo.src = videoSrc;
        modalVideo.play().catch(error => console.error('Erreur de lecture vid√©o:', error));
        document.body.style.overflow = 'hidden';
    };
}

/**
 * Cr√©e et initialise la modale pour la s√©lection des avis par √©toiles
 */
function initReviewsModal() {
    reviewsModal = document.createElement('div');
    reviewsModal.className = 'modal-overlay hidden';
    reviewsModal.innerHTML = `
        <div class="modal-content">
            <h3 class="text-2xl font-bold text-center mb-6 text-gray-900 dark:text-white">S√©lectionner le minimum d'avis</h3>
            <div class="star-selection-container">
                <div class="star-row" id="star-row">
                    ${[...Array(5)].map((_, i) => `
                        <svg class="star-svg ${i === 0 ? 'selected' : ''}" data-level="${i + 1}" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                    `).join('')}
                </div>
                <div class="selection-label text-center mt-4 text-gray-600 dark:text-gray-300" id="selection-label">
                    Cliquez sur une √©toile pour s√©lectionner
                </div>
                <div class="tooltip text-center mt-2 text-sm text-gray-500 dark:text-gray-400 hidden" id="tooltip">
                    <!-- Tooltip will be updated here -->
                </div>
            </div>
            <div class="flex justify-center mt-8 gap-4">
                <button id="reviews-modal-cancel" class="px-6 py-2 bg-gray-300 dark:bg-gray-600 text-gray-900 dark:text-white rounded-xl hover:bg-gray-400 dark:hover:bg-gray-500 transition-all duration-300">Annuler</button>
                <button id="reviews-modal-confirm" class="px-6 py-2 bg-ll-blue text-white rounded-xl hover:bg-blue-700 transition-all duration-300">Confirmer</button>
            </div>
        </div>
    `;
    document.body.appendChild(reviewsModal);

    const starRow = document.getElementById('star-row');
    const selectionLabel = document.getElementById('selection-label');
    const tooltip = document.getElementById('tooltip');

    // Niveaux d'avis par √©toile
    const reviewLevels = {
        1: { min: 10, label: '‚â• 10 avis' },
        2: { min: 25, label: '‚â• 25 avis' },
        3: { min: 50, label: '‚â• 50 avis' },
        4: { min: 75, label: '‚â• 75 avis' },
        5: { min: 100, label: '‚â• 100 avis' }
    };

    // Fonction pour mettre √† jour l'affichage des √©toiles (remplissage)
    function updateStarDisplay(hoveredLevel = null) {
        // Trouver le niveau s√©lectionn√©
        let selectedLevel = null;
        starRow.querySelectorAll('.star-svg').forEach(star => {
            if (star.classList.contains('selected')) {
                selectedLevel = parseInt(star.dataset.level);
            }
        });

        const fillLevel = hoveredLevel || selectedLevel || 0;

        // Mettre √† jour chaque √©toile
        starRow.querySelectorAll('.star-svg').forEach(star => {
            const level = parseInt(star.dataset.level);
            if (level <= fillLevel) {
                star.setAttribute('fill', '#fbbf24');
                star.setAttribute('stroke', '#fbbf24');
            } else {
                star.setAttribute('fill', 'none');
                star.setAttribute('stroke', '#d1d5db');
            }
        });

        // Mettre √† jour le label et tooltip
        if (hoveredLevel) {
            selectionLabel.textContent = reviewLevels[hoveredLevel].label;
            tooltip.textContent = `S√©lectionnez pour filtrer les services avec au moins ${reviewLevels[hoveredLevel].min} avis et commentaires.`;
            tooltip.classList.remove('hidden');
        } else if (selectedLevel) {
            selectionLabel.textContent = reviewLevels[selectedLevel].label;
            tooltip.textContent = `Filtre actif : au moins ${reviewLevels[selectedLevel].min} avis et commentaires.`;
            tooltip.classList.remove('hidden');
        } else {
            selectionLabel.textContent = 'Aucun filtre (Tous les services)';
            tooltip.classList.add('hidden');
        }
    }

    // Hover effects
    starRow.addEventListener('mouseenter', (e) => {
        const hoveredStar = e.target.closest('.star-svg');
        if (hoveredStar) {
            const level = parseInt(hoveredStar.dataset.level);
            updateStarDisplay(level);
        }
    }, true);

    starRow.addEventListener('mouseleave', () => {
        updateStarDisplay(); // Remettre √† l'√©tat s√©lectionn√© seulement
    });

    // S√©lection par clic
    starRow.addEventListener('click', (e) => {
        const clickedStar = e.target.closest('.star-svg');
        if (clickedStar) {
            // D√©s√©lectionner tous
            starRow.querySelectorAll('.star-svg').forEach(star => star.classList.remove('selected'));
            // S√©lectionner la cliqu√©e
            clickedStar.classList.add('selected');
            const level = parseInt(clickedStar.dataset.level);
            updateStarDisplay(); // Met √† jour avec le nouveau selectedLevel
            // Mettre √† jour l'input cach√© si n√©cessaire
            const input = document.getElementById('reviewsMin-input');
            if (input) {
                input.value = reviewLevels[level].min;
            } else {
                // Cr√©er si n'existe pas
                const newInput = document.createElement('input');
                newInput.type = 'hidden';
                newInput.id = 'reviewsMin-input';
                newInput.value = reviewLevels[level].min;
                document.querySelector('.filter-group')?.appendChild(newInput);
            }
        }
    });

    // Boutons
    reviewsModal.querySelector('#reviews-modal-cancel').addEventListener('click', closeReviewsModal);
    reviewsModal.querySelector('#reviews-modal-confirm').addEventListener('click', confirmReviewsSelection);

    function closeReviewsModal() {
        reviewsModal.classList.remove('open');
        setTimeout(() => {
            reviewsModal.classList.add('hidden');
            updateStarDisplay(); // Reset display
        }, 300);
    }

    function confirmReviewsSelection() {
        const selectedStar = starRow.querySelector('.star-svg.selected');
        if (selectedStar) {
            const level = parseInt(selectedStar.dataset.level);
            const minReviews = reviewLevels[level].min;
            // Mettre √† jour le filtre
            const input = document.getElementById('reviewsMin-input');
            if (input) {
                input.value = minReviews;
            } else {
                // Cr√©er si n'existe pas
                const newInput = document.createElement('input');
                newInput.type = 'hidden';
                newInput.id = 'reviewsMin-input';
                newInput.value = minReviews;
                document.querySelector('.filter-group')?.appendChild(newInput);
            }
            updateActiveFilters();
            updateServices();
        }
        closeReviewsModal();
    }

    // Ouvrir depuis le picker
    document.querySelector('.star-picker').addEventListener('click', () => {
        reviewsModal.classList.remove('hidden');
        setTimeout(() => {
            reviewsModal.classList.add('open');
            updateStarDisplay(); // Initial display
        }, 10);
    });

    // Initial display
    updateStarDisplay();
}

/**
 * Cr√©e et initialise la modale pour les cat√©gories (6x sur desktop, 4x sur mobile)
 */
function initCategoryModal() {
    categoryModal = document.createElement('div');
    categoryModal.className = 'modal-overlay';
    categoryModal.innerHTML = `
        <div class="modal-content">
            <h3 class="text-2xl font-bold text-center mb-6 text-gray-900 dark:text-white">S√©lectionner une cat√©gorie</h3>
            <input type="text" id="modal-category-search" class="w-full p-3 mb-4 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-ll-blue text-gray-900 dark:text-gray-100" placeholder="Rechercher une cat√©gorie...">
            <div id="modal-category-grid" class="category-grid"></div>
            <div class="flex justify-center mt-6 gap-4">
                <button id="category-modal-cancel" class="px-6 py-2 bg-gray-300 dark:bg-gray-600 text-gray-900 dark:text-white rounded-xl hover:bg-gray-400 dark:hover:bg-gray-500 transition-all">Annuler</button>
                <button id="category-modal-confirm" class="px-6 py-2 bg-ll-blue text-white rounded-xl hover:shadow-lg neon-glow transition-all">Confirmer</button>
            </div>
        </div>
    `;
    document.body.appendChild(categoryModal);

    // Remplir la grille
    const categories = [
        { id: 'bureaux', name: 'Bureaux', icon: 'üè¢' },
        { id: 'residentiel', name: 'R√©sidentiel', icon: 'üè†' },
        { id: 'commercial', name: 'Commercial', icon: 'üõçÔ∏è' },
        { id: 'industriel', name: 'Industriel', icon: 'üè≠' },
        { id: 'medical', name: 'M√©dical', icon: 'üè•' },
        { id: 'hotelier', name: 'H√¥telier', icon: 'üè®' },
        { id: 'education', name: '√âducation', icon: 'üéì' },
        { id: 'restaurant', name: 'Restaurant', icon: 'üçΩÔ∏è' },
        { id: 'sport', name: 'Sport & Fitness', icon: 'üí™' },
        { id: 'evenementiel', name: '√âv√©nementiel', icon: 'üé™' }
    ];

    const grid = categoryModal.querySelector('#modal-category-grid');
    grid.innerHTML = categories.map(category => `
        <button class="category-option flex items-center gap-3 p-4 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/50 transition-all duration-300 w-full text-left focus:outline-none focus:ring-2 focus:ring-blue-500 group glass-effect ${category.id === getCurrentFilters().category ? 'selected bg-ll-blue text-white' : ''}" data-category="${category.id}">
            <span class="text-2xl transform group-hover:scale-110 transition-transform">${category.icon}</span>
            <span class="text-sm font-medium text-gray-900 dark:text-white flex-1">${category.name}</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity">
                <path d="M5 12h14"></path><path d="M12 5l7 7-7 7"></path>
            </svg>
        </button>
    `).join('');

    // Recherche dans modale
    const searchInput = categoryModal.querySelector('#modal-category-search');
    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        grid.querySelectorAll('.category-option').forEach(option => {
            const name = option.querySelector('span:nth-child(2)').textContent.toLowerCase();
            option.style.display = name.includes(term) ? 'flex' : 'none';
        });
    });

    // S√©lection
    grid.addEventListener('click', (e) => {
        const option = e.target.closest('.category-option');
        if (option) {
            grid.querySelectorAll('.category-option').forEach(s => s.classList.remove('selected', 'bg-ll-blue', 'text-white'));
            option.classList.add('selected', 'bg-ll-blue', 'text-white');
        }
    });

    // Boutons
    categoryModal.querySelector('#category-modal-cancel').addEventListener('click', closeCategoryModal);
    categoryModal.querySelector('#category-modal-confirm').addEventListener('click', confirmCategorySelection);

    function closeCategoryModal() {
        categoryModal.classList.remove('open');
        setTimeout(() => categoryModal.classList.add('hidden'), 300);
    }

    function confirmCategorySelection() {
        const selected = grid.querySelector('.category-option.selected');
        if (selected) {
            const categoryId = selected.dataset.category;
            const categoryName = selected.querySelector('span:nth-child(2)').textContent;
            document.getElementById('selected-category').textContent = categoryName;
            // Update hidden input
            let input = document.querySelector('input[name="category"]');
            if (!input) {
                input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'category';
                document.getElementById('category-dropdown').appendChild(input);
            }
            input.value = categoryId;
            updateActiveFilters();
            updateServices();
        }
        closeCategoryModal();
    }

    // Ouvrir depuis dropdown
    document.getElementById('category-dropdown').addEventListener('click', (e) => {
        e.stopPropagation();
        categoryModal.classList.remove('hidden');
        setTimeout(() => categoryModal.classList.add('open'), 10);
    });
}

/**
 * Initialise les dropdowns de filtres avec animations (fr√©quence et difficult√© restent dropdowns)
 */
function initFilterDropdowns() {
    const dropdowns = [
        { trigger: 'frequency-dropdown', menu: 'frequency-options' },
        { trigger: 'difficulty-dropdown', menu: 'difficulty-options' }
    ];

    dropdowns.forEach(({ trigger, menu }) => {
        const triggerEl = document.getElementById(trigger);
        const menuEl = document.getElementById(menu);

        if (triggerEl && menuEl) {
            triggerEl.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = !menuEl.classList.contains('hidden');
                
                // Close all other dropdowns
                document.querySelectorAll('[id$="-options"]').forEach(otherMenu => {
                    if (otherMenu !== menuEl) {
                        otherMenu.classList.add('hidden', 'scale-95', 'opacity-0');
                    }
                });

                if (isOpen) {
                    menuEl.classList.add('hidden', 'scale-95', 'opacity-0');
                } else {
                    menuEl.classList.remove('hidden');
                    setTimeout(() => {
                        menuEl.classList.remove('scale-95', 'opacity-0');
                    }, 10);
                }
            });
        }
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', () => {
        document.querySelectorAll('[id$="-options"]').forEach(menu => {
            menu.classList.add('hidden', 'scale-95', 'opacity-0');
        });
    });

    // √âv√©nements pour les radios (fr√©quence et difficult√©) - mise √† jour imm√©diate
    document.querySelectorAll('input[name="frequency"], input[name="difficulty"]').forEach(radio => {
        radio.addEventListener('change', () => {
            if (radio.checked && radio.value !== 'all') {
                const dropdownId = radio.name === 'frequency' ? 'selected-frequency' : 'selected-difficulty';
                const selectedEl = document.getElementById(dropdownId);
                if (selectedEl) {
                    selectedEl.textContent = radio.nextElementSibling.textContent;
                }
            } else if (radio.checked && radio.value === 'all') {
                const dropdownId = radio.name === 'frequency' ? 'selected-frequency' : 'selected-difficulty';
                const selectedEl = document.getElementById(dropdownId);
                if (selectedEl) {
                    selectedEl.textContent = radio.name === 'frequency' ? 'Toutes les fr√©quences' : 'Tous les niveaux';
                }
            }
            updateActiveFilters();
            updateServices();
        });
    });
}

/**
 * Initialise le timer d'inactivit√© pour fermer le panel de filtres
 */
function initFilterInactivityTimer() {
    const filterPanel = document.getElementById('filter-panel');
    if (!filterPanel) return;

    const resetTimer = () => {
        clearTimeout(filterInactivityTimer);
        filterInactivityTimer = setTimeout(() => {
            filterPanel.classList.add('hidden');
        }, INACTIVITY_CLOSE_DELAY);
    };

    // Reset on interaction within panel
    filterPanel.addEventListener('mousemove', resetTimer);
    filterPanel.addEventListener('click', resetTimer);
    filterPanel.addEventListener('scroll', resetTimer);

    // Toggle filter panel open/close on button click
    document.getElementById('open-filter-panel').addEventListener('click', () => {
      if (filterPanel.classList.contains('hidden')) {
        filterPanel.classList.remove('hidden');
        resetTimer();
      } else {
        filterPanel.classList.add('hidden');
        clearTimeout(filterInactivityTimer);
      }
    });
}

/**
 * Initialise la recherche en temps r√©el avec debounce
 */
function initSearch() {
    const searchInput = document.getElementById('service-search');
    const clearButton = document.getElementById('clear-search');
    if (!searchInput || !clearButton) return;

    let searchTimeout;
    
    searchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            updateServices();
        }, 300);
        
        // Animation de recherche avec glow
        if (e.target.value) {
            searchInput.parentElement.classList.add('ring-2', 'ring-ll-blue', 'neon-glow');
            clearButton.classList.remove('hidden');
        } else {
            searchInput.parentElement.classList.remove('ring-2', 'ring-ll-blue', 'neon-glow');
            clearButton.classList.add('hidden');
        }
    });

    clearButton.addEventListener('click', () => {
        searchInput.value = '';
        searchInput.focus();
        clearButton.classList.add('hidden');
        updateServices();
    });
}

/**
 * Affiche l'animation de chargement avec effets
 */
function showLoadingAnimation(show = true) {
    toggleServicesLoading(show);
    const container = document.getElementById('service-detail-container');
    if (container) {
        container.style.opacity = show ? '0.5' : '1';
        if (show) {
            container.classList.add('animate-pulse');
        } else {
            container.classList.remove('animate-pulse');
        }
    }
}

/**
 * Initialise les interactions principales avec timer d'inactivit√©
 */
export function initServiceInteractions() {
 
    initFilterInactivityTimer();
    document.getElementById('reset-filters')?.addEventListener('click', resetAllFilters);
    initCategoryModal();
    initReviewsModal();
    initFilterDropdowns();
    initSearch();
}

/**
 * Met √† jour l'affichage des filtres actifs avec badges futuristes
 */
function updateActiveFilters() {
    const activeFiltersContainer = document.getElementById('active-filters');
    
    if (!activeFiltersContainer) return;

    const filters = getCurrentFilters();
    const activeFilters = [];

    // Category filter
    if (filters.category && filters.category !== 'all') {
        const categoryName = document.getElementById('selected-category').textContent;
        activeFilters.push({
            type: 'category',
            value: filters.category,
            label: categoryName,
            color: 'blue'
        });
    }

    // Frequency filter
    if (filters.frequency && filters.frequency !== 'all') {
        const frequencyName = document.getElementById('selected-frequency').textContent;
        activeFilters.push({
            type: 'frequency',
            value: filters.frequency,
            label: frequencyName,
            color: 'green'
        });
    }

    // Difficulty filter
    if (filters.difficulty && filters.difficulty !== 'all') {
        const difficultyName = document.getElementById('selected-difficulty').textContent;
        activeFilters.push({
            type: 'difficulty',
            value: filters.difficulty,
            label: difficultyName,
            color: 'purple'
        });
    }

    // Reviews filter
    if (filters.reviewsMin > 0) {
        activeFilters.push({
            type: 'reviews',
            value: filters.reviewsMin,
            label: `Min. ${filters.reviewsMin} avis`,
            color: 'yellow'
        });
    }

    // Update active filters display with glass effect
    if (activeFilters.length > 0) {
        activeFiltersContainer.innerHTML = activeFilters.map(filter => `
            <span class="inline-flex items-center gap-2 bg-${filter.color}-100/50 dark:bg-${filter.color}-900/50 text-${filter.color}-800 dark:text-${filter.color}-200 px-3 py-2 rounded-xl text-sm font-medium transition-all duration-300 hover:scale-105 cursor-pointer remove-filter glass-effect neon-glow" data-type="${filter.type}">
                ${filter.label}
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hover:scale-110 transition-transform">
                    <path d="M18 6L6 18"></path><path d="M6 6l12 12"></path>
                </svg>
            </span>
        `).join('');
        activeFiltersContainer.classList.remove('hidden');
    } else {
        activeFiltersContainer.classList.add('hidden');
    }

    // Add remove filter functionality
    document.querySelectorAll('.remove-filter').forEach(button => {
        button.addEventListener('click', function() {
            const filterType = this.dataset.type;
            removeFilter(filterType);
        });
    });
}

/**
 * Supprime un filtre sp√©cifique
 */
function removeFilter(filterType) {
    switch (filterType) {
        case 'category':
            document.getElementById('selected-category').textContent = 'Toutes les cat√©gories';
            document.querySelector('input[name="category"]')?.remove();
            break;
        case 'frequency':
            document.getElementById('selected-frequency').textContent = 'Toutes les fr√©quences';
            document.querySelector('input[name="frequency"][value="all"]').checked = true;
            break;
        case 'difficulty':
            document.getElementById('selected-difficulty').textContent = 'Tous les niveaux';
            document.querySelector('input[name="difficulty"][value="all"]').checked = true;
            break;
        case 'reviews':
            // Reset to 0 in hidden input or state
            const reviewsInput = document.getElementById('reviewsMin-input') || { value: 0 };
            reviewsInput.value = 0;
            // Update display stars
            document.getElementById('reviews-star-display').innerHTML = renderStarRatingForReviews(0);
            break;
    }
    updateActiveFilters();
    updateServices();
}

/**
 * R√©cup√®re les filtres actuels
 */
function getCurrentFilters() {
    return {
        category: document.querySelector('input[name="category"]')?.value || 'all',
        frequency: document.querySelector('input[name="frequency"]:checked')?.value || 'all',
        difficulty: document.querySelector('input[name="difficulty"]:checked')?.value || 'all',
        reviewsMin: parseInt(document.getElementById('reviewsMin-input')?.value || 0) || 0,
        search: document.getElementById('service-search')?.value || ''
    };
}

/**
 * Rend les √©toiles pour l'affichage des avis min (similaire √† renderStarRating)
 */
function renderStarRatingForReviews(rating) {
    // Similar to renderStarRating but for reviews display
    return Array.from({ length: 5 }, (_, i) => `
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="${i < rating / 20 ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2" class="text-yellow-400">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
    `).join(''); // Simplified for reviews
}

/**
 * Initialise l'affichage des √©toiles pour reviews
 */
function initReviewsDisplay() {
    const display = document.getElementById('reviews-star-display');
    if (display) {
        display.innerHTML = renderStarRatingForReviews(0);
    }
}

/**
 * R√©initialise tous les filtres
 */
function resetAllFilters() {
    // Reset category
    document.getElementById('selected-category').textContent = 'Toutes les cat√©gories';
    document.querySelector('input[name="category"]')?.remove();
    
    // Reset frequency
    document.getElementById('selected-frequency').textContent = 'Toutes les fr√©quences';
    document.querySelector('input[name="frequency"][value="all"]').checked = true;
    
    // Reset difficulty
    document.getElementById('selected-difficulty').textContent = 'Tous les niveaux';
    document.querySelector('input[name="difficulty"][value="all"]').checked = true;
    
    // Reset reviews
    const reviewsInput = document.getElementById('reviewsMin-input') || { value: 0 };
    reviewsInput.value = 0;
    initReviewsDisplay();
    
    // Reset search
    document.getElementById('service-search').value = '';
    document.getElementById('clear-search').classList.add('hidden');
    
    updateActiveFilters();
    updateServices();
}

/**
 * Met √† jour l'affichage des services (import from loadServices.js)
 */
async function updateServices() {
    showLoadingAnimation(true);
    
    const filters = getCurrentFilters();
    
    try {
        const services = await loadServices(filters);
        renderServicesSidebar(services);
        
        if (services.length > 0) {
            // Toujours afficher le premier service si l'index actuel est invalide
            if (currentServiceIndex >= services.length) {
                currentServiceIndex = 0;
            }
            renderServiceDetail(services[currentServiceIndex], currentServiceIndex, services.length);
        } else {
            showNoServicesMessage();
        }
        
        // Update services count
        const servicesCount = document.getElementById('services-count');
        if (servicesCount) {
            servicesCount.textContent = services.length;
        }
        
    } catch (error) {
        console.error('Erreur lors du chargement des services:', error);
        showNotification('Erreur lors du chargement des services.', 'error');
    } finally {
        showLoadingAnimation(false);
    }
}

/**
 * Affiche un message lorsqu'aucun service n'est trouv√© avec design futuriste
 */
function showNoServicesMessage() {
    const container = document.getElementById('service-detail-container');
    if (!container) return;

    container.innerHTML = `
        <div class="text-center py-20 glass-effect neon-glow" data-aos="zoom-in">
            <div class="max-w-md mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 mx-auto mb-6 animate-pulse">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    <line x1="11" y1="8" x2="11" y2="14"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Aucun service trouv√©</h3>
                <p class="text-gray-600 dark:text-gray-300 mb-8">Aucun service ne correspond √† vos crit√®res de recherche. Essayez de modifier vos filtres.</p>
                <button id="reset-search-filters" class="bg-gradient-to-r from-ll-blue to-blue-600 text-white py-3 px-6 rounded-xl hover:from-blue-600 hover:to-ll-dark-blue transition-all duration-300 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 neon-glow">
                    R√©initialiser les filtres
                </button>
            </div>
        </div>
    `;

    document.getElementById('reset-search-filters')?.addEventListener('click', resetAllFilters);
}




/**
 * Initialisation globale
 */
document.addEventListener('DOMContentLoaded', async () => {
  await loadMockData();



  initAbout();
  initHeroCarousel();
  initTestimonialsCarousel();
  initFAQSection();
  initTeamSection();
  initPartnersSection();
  initBlogSection();
  initEventsSection();
  initGallerySection();
  initStatsSection();
  initPricingSection();
  initContactsSection();
 // initBeforeAfterSliders();
  initParticles();
  initScrollAnimations();
  initVideoModal();
  initWhyUsSection();
  initEco();
  renderBeforeAfter();

  



    initReviewsDisplay();
    initServiceInteractions();
    updateServices();

});
